/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/base/Object","sap/ui/core/IntervalTrigger","sap/ui/thirdparty/jquery","sap/ui/util/ActivityDetection"],function(e,t,i,s,n){"use strict";var r=e.getLogger("sap.ui.core.ResizeHandler",e.Level.ERROR);var o;var a=t.extend("sap.ui.core.ResizeHandler",{constructor:function(){t.apply(this);this.aResizeListeners=[];this.aSuspendedDomRefs=[];this.bRegistered=false;this.mCallbacks=new Map;this.iIdCounter=0;this.fnDestroyHandler=this.destroy.bind(this);s(window).on("unload",this.fnDestroyHandler);n.attachActivate(u,this);if(o){r.error("ResizeHandler is designed as a singleton and should not be created manually! "+"Please require 'sap/ui/core/ResizeHandler' instead and use the module export directly without using 'new'.")}}});function d(){if(this.bRegistered){this.bRegistered=false;i.removeListener(this.checkSizes,this)}}function u(){if(!this.bRegistered&&this.aResizeListeners.length>0){this.bRegistered=true;i.addListener(this.checkSizes,this)}}a.prototype.destroy=function(e){n.detachActivate(u,this);s(window).off("unload",this.fnDestroyHandler);this.aResizeListeners=[];this.aSuspendedDomRefs=[];d.call(this)};a.prototype.attachListener=function(e,i){var n=t.isA(e,"sap.ui.core.Control"),o=e instanceof s,a=n?e.getDomRef():e,d=a?a.offsetWidth:0,f=a?a.offsetHeight:0,h="rs-"+Date.now()+"-"+this.iIdCounter++,l;if(n){l="Control "+e.getId()}else if(e.id){l=e.id}else{l=String(e)}this.aResizeListeners.push({sId:h,oDomRef:n?null:e,oControl:n?e:null,bIsJQuery:o,fHandler:i,iWidth:d,iHeight:f,dbg:l});r.debug("registered "+l);u.call(this);return h};a.prototype.detachListener=function(e){var t=this.aResizeListeners;for(var i=0;i<t.length;i++){if(t[i].sId===e){t.splice(i,1);r.debug("deregistered "+e);break}}if(t.length===0){d.call(this)}};a.prototype.checkSizes=function(){var e=r.isLoggable();if(e){r.debug("checkSizes:")}this.aResizeListeners.forEach(function(t){if(t){var i=!!t.oControl,n=i?t.oControl.getDomRef():t.oDomRef;n=t.bIsJQuery?n[0]:n;if(n&&document.documentElement.contains(n)&&!this._isSuspended(n)){var o=t.iWidth,a=t.iHeight,d=n.offsetWidth,u=n.offsetHeight;if(o!=d||a!=u){t.iWidth=d;t.iHeight=u;var f=s.Event("resize");f.target=n;f.currentTarget=n;f.size={width:d,height:u};f.oldSize={width:o,height:a};f.control=i?t.oControl:null;if(e){r.debug("resize detected for '"+t.dbg+"': "+f.oldSize.width+"x"+f.oldSize.height+" -> "+f.size.width+"x"+f.size.height)}t.fHandler(f)}}}},this);if(a._keepActive!=true&&a._keepActive!=false){a._keepActive=false}if(!n.isActive()&&!a._keepActive){d.call(this)}};a.register=function(e,t){return o.attachListener(e,t)};a.deregister=function(e){o.detachListener(e)};a.deregisterAllForControl=function(e){o.aResizeListeners.filter(function(t){return t&&t.oControl&&t.oControl.getId()===e}).forEach(function(e){a.deregister(e.sId)})};a.suspend=function(e){if(!document.documentElement.contains(e)){return false}if(o.aSuspendedDomRefs.indexOf(e)===-1){o.aSuspendedDomRefs.push(e)}return true};a.resume=function(e){var t=o.aSuspendedDomRefs.indexOf(e);if(t===-1){return false}o.aSuspendedDomRefs.splice(t,1);o.checkSizes();var i=o.mCallbacks.get(e);if(i){for(var s=0;s<i.length;s++){i[s]()}o.mCallbacks.delete(e)}return true};a.prototype._isSuspended=function(e){var t=this.aSuspendedDomRefs,i;for(var s=0;s<t.length;s++){i=t[s];if(i.contains(e)){return i}}return false};a.isSuspended=function(e,t){var i=o._isSuspended(e);if(t&&i){var s=o.mCallbacks.get(i);if(!s){s=[];o.mCallbacks.set(i,s)}if(s.indexOf(t)===-1){s.push(t)}}return!!i};o=new a;return a});